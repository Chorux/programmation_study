<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilha de Estudos de Programa√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .custom-checkbox:checked {
            background-color: #4F46E5;
            border-color: #4F46E5;
        }
        .custom-checkbox:checked + a {
            text-decoration: line-through;
            color: #6B7280;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .notes-container {
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
        }
        .notes-container.open {
            max-height: 200px;
            padding-top: 1rem;
        }
        #ai-assistant {
            transition: transform 0.3s ease-in-out;
        }
        .message-ai .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .message-content pre, .modal-content pre {
            background-color: #1E293B;
            color: #E2E8F0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .message-content code, .modal-content code {
            font-family: 'Courier New', Courier, monospace;
        }
        .message-content p, .modal-content p {
            margin-bottom: 1rem;
        }
        .message-content h1, .message-content h1, .modal-content h2, .modal-content h3 {
            font-weight: 600;
            margin-bottom: 0.5rem;
            margin-top: 1rem;
        }
        .message-content ul, .message-content ol, .modal-content ul, .modal-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            list-style: revert;
        }
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            background-color: #4F46E5;
            color: white;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .info-icon {
            cursor: pointer;
            color: #6b7280;
            font-weight: bold;
            border: 1px solid #d1d5db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-style: normal;
            margin-left: 8px;
        }
        .info-icon:hover {
            background-color: #e5e7eb;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="relative min-h-screen flex flex-col">
        <!-- Main Content -->
        <main class="container mx-auto p-4 sm:p-6 lg:p-8 flex-grow">
            <header class="text-center mb-8 relative">
                <h1 id="main-title" class="text-4xl font-bold text-slate-900"></h1>
                <p id="main-subtitle" class="text-slate-600 mt-2"></p>
                <button id="lang-switcher" class="absolute top-0 right-0 bg-slate-200 text-slate-700 px-3 py-1 rounded-md text-sm font-medium hover:bg-slate-300 transition">
                    EN / PT
                </button>
            </header>

            <!-- Se√ß√£o de Progresso Geral -->
            <div class="mb-10 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 id="progress-title" class="text-2xl font-semibold mb-4 text-slate-800"></h2>
                <div class="w-full bg-slate-200 rounded-full h-6">
                    <div id="progressBar" class="bg-indigo-600 h-6 rounded-full text-center text-white text-sm font-medium leading-6 progress-bar-fill" style="width: 0%;">
                        0%
                    </div>
                </div>
            </div>
            
            <!-- Abas de Conte√∫do -->
            <div class="mb-8">
                <div id="tab-selector" class="flex flex-wrap justify-center border-b border-slate-200">
                    <!-- Abas ser√£o inseridas aqui -->
                </div>
            </div>

            <!-- Conte√∫do dos M√≥dulos -->
            <div id="modulesContainer" class="space-y-6">
                <!-- Os m√≥dulos ser√£o inseridos aqui -->
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="w-full text-center p-6 text-slate-500 text-sm">
            <p id="footer-text"></p>
        </footer>

        <!-- AI Assistant Panel -->
        <div id="ai-assistant" class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-lg transform translate-x-full z-[60] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50">
                <h2 id="ai-assistant-title" class="text-xl font-semibold text-slate-800"></h2>
                <div class="flex items-center gap-2">
                    <button id="settings-btn" class="p-2 rounded-full hover:bg-slate-200 text-xl leading-none" title="Configura√ß√µes">‚öôÔ∏è</button>
                    <button id="close-ai" class="p-2 rounded-full hover:bg-slate-200 text-2xl leading-none" title="Fechar">&times;</button>
                </div>
            </div>
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4 flex flex-col"></div>
            <div class="p-4 border-t bg-slate-50">
                <div class="flex gap-2">
                    <input id="chat-input" type="text" class="w-full p-2 border border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    <button id="send-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"></button>
                </div>
            </div>
        </div>
        <div id="api-key-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[100]">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md mx-4">
                <h3 id="modal-title" class="text-lg font-bold mb-4"></h3>
                <p id="modal-desc" class="text-sm text-slate-600 mb-4"></p>
                <ol id="modal-steps" class="text-sm text-slate-600 mb-4 list-decimal list-inside space-y-1"></ol>
                <input id="api-key-input" type="password" class="w-full p-2 border border-slate-300 rounded-md mb-4">
                <div class="flex justify-end gap-2">
                    <button id="cancel-api-key" class="px-4 py-2 bg-slate-200 rounded-md hover:bg-slate-300">Cancelar</button>
                    <button id="save-api-key" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"></button>
                </div>
            </div>
        </div>
        <button id="toggle-ai" class="fixed bottom-8 right-8 bg-indigo-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center text-3xl z-40 hover:bg-indigo-700 transition">ü§ñ</button>

        <!-- Content Info Modal -->
        <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[100]">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl mx-4 h-[90vh] flex flex-col">
                <div class="flex justify-between items-center border-b pb-3">
                    <h3 id="info-modal-title" class="text-2xl font-bold"></h3>
                    <button id="close-info-modal" class="p-2 rounded-full hover:bg-slate-200 text-2xl leading-none">&times;</button>
                </div>
                <div id="info-modal-content" class="mt-4 overflow-y-auto flex-grow modal-content"></div>
            </div>
        </div>
    </div>

    <script>
        const contentData = {
            general: {
                pt: [
                    { module: "Fase 1: O Pensamento Computacional", topics: [{ id: "algoritmo", name: "O que √© um Algoritmo?", link: "https://www.alura.com.br/artigos/o-que-e-um-algoritmo" }, { id: "logica", name: "L√≥gica de Programa√ß√£o", link: "https://www.devmedia.com.br/logica-de-programacao-o-primeiro-passo/23345" }, { id: "pseudo", name: "Pseudoc√≥digo e Fluxogramas", link: "https://www.geeksforgeeks.org/how-to-write-a-pseudo-code/" }, { id: "problemas", name: "Resolu√ß√£o de Problemas", link: "https://www.khanacademy.org/computing/computer-programming/programming/intro-to-programming/a/problem-solving-steps" }] },
                    { module: "Fase 2: As Ferramentas Fundamentais", topics: [{ id: "variaveis", name: "Vari√°veis e Tipos de Dados", link: "https://www.freecodecamp.org/news/data-types-in-computer-science/" }, { id: "operadores", name: "Operadores (Matem√°ticos, L√≥gicos)", link: "https://www.tutorialspoint.com/computer_programming/computer_programming_operators.htm" }, { id: "controle", name: "Estruturas de Controle (Condicionais e La√ßos)", link: "https://www.freecodecamp.org/news/control-flow-in-programming/" }, { id: "funcoes", name: "Fun√ß√µes e Procedimentos", link: "https://www.freecodecamp.org/news/what-is-a-function-javascript-function-examples/" }, { id: "estruturas", name: "Estruturas de Dados B√°sicas (Arrays, Listas)", link: "https://www.freecodecamp.org/news/data-structures-101-arrays-and-linked-lists-3f6224c0886b/" }] },
                    { module: "Fase 3: Organizando o C√≥digo", topics: [{ id: "paradigmas", name: "Paradigmas de Programa√ß√£o (POO, Funcional)", link: "https://www.freecodecamp.org/news/an-introduction-to-programming-paradigms/" }, { id: "modularizacao", name: "Modulariza√ß√£o e Reutiliza√ß√£o de C√≥digo", link: "https://www.baeldung.com/cs/modular-programming" }, { id: "erros", name: "Tratamento de Erros e Exce√ß√µes", link: "https://www.freecodecamp.org/news/error-handling-in-programming/" }, { id: "abstracao", name: "Abstra√ß√£o e Encapsulamento", link: "https://www.freecodecamp.org/news/what-is-abstraction-in-oop-java-c-example/" }] },
                    { module: "Fase 4: Interagindo com o Mundo", topics: [{ id: "api", name: "O que √© uma API?", link: "https://www.redhat.com/pt-br/topics/api/what-are-application-programming-interfaces" }, { id: "db", name: "Fundamentos de Banco de Dados (SQL vs NoSQL)", link: "https://www.mongodb.com/compare/sql-vs-nosql" }, { id: "terminal", name: "Linha de Comando (Terminal)", link: "https://www.freecodecamp.org/news/command-line-for-beginners/" }, { id: "http", name: "Protocolo HTTP e a Web", link: "https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Overview" }] },
                    { module: "Fase 5: O Ciclo de Vida do Software", topics: [{ id: "git", name: "Controle de Vers√£o com Git", link: "https://git-scm.com/book/pt-br/v2" }, { id: "testes", name: "A Import√¢ncia dos Testes", link: "https://www.atlassian.com/continuous-delivery/software-testing/types-of-software-testing" }, { id: "debug", name: "Depura√ß√£o (Debugging)", link: "https://www.freecodecamp.org/news/what-is-debugging-how-to-debug-code/" }, { id: "boaspraticas", name: "Boas Pr√°ticas (SOLID, DRY, KISS)", link: "https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-5-principles-of-object-oriented-design" }] },
                ],
                en: [
                    { module: "Phase 1: Computational Thinking", topics: [{ id: "algoritmo", name: "What is an Algorithm?", link: "https://www.geeksforgeeks.org/introduction-to-algorithms/" }, { id: "logica", name: "Programming Logic", link: "https://www.freecodecamp.org/news/programming-logic-how-to-start-thinking-like-a-coder/" }, { id: "pseudo", name: "Pseudocode and Flowcharts", link: "https://www.geeksforgeeks.org/how-to-write-a-pseudo-code/" }, { id: "problemas", name: "Problem Solving", link: "https://www.khanacademy.org/computing/computer-programming/programming/intro-to-programming/a/problem-solving-steps" }] },
                    { module: "Phase 2: The Fundamental Tools", topics: [{ id: "variaveis", name: "Variables and Data Types", link: "https://www.freecodecamp.org/news/data-types-in-computer-science/" }, { id: "operadores", name: "Operators (Mathematical, Logical)", link: "https://www.tutorialspoint.com/computer_programming/computer_programming_operators.htm" }, { id: "controle", name: "Control Structures (Conditionals and Loops)", link: "https://www.freecodecamp.org/news/control-flow-in-programming/" }, { id: "funcoes", name: "Functions and Procedures", link: "https://www.freecodecamp.org/news/what-is-a-function-javascript-function-examples/" }, { id: "estruturas", name: "Basic Data Structures (Arrays, Lists)", link: "https://www.freecodecamp.org/news/data-structures-101-arrays-and-linked-lists-3f6224c0886b/" }] },
                    { module: "Phase 3: Organizing Code", topics: [{ id: "paradigmas", name: "Programming Paradigms (OOP, Functional)", link: "https://www.freecodecamp.org/news/an-introduction-to-programming-paradigms/" }, { id: "modularizacao", name: "Modularization and Code Reuse", link: "https://www.baeldung.com/cs/modular-programming" }, { id: "erros", name: "Error and Exception Handling", link: "https://www.freecodecamp.org/news/error-handling-in-programming/" }, { id: "abstracao", name: "Abstraction and Encapsulation", link: "https://www.freecodecamp.org/news/what-is-abstraction-in-oop-java-c-example/" }] },
                    { module: "Phase 4: Interacting with the World", topics: [{ id: "api", name: "What is an API?", link: "https://www.redhat.com/en/topics/api/what-are-application-programming-interfaces" }, { id: "db", name: "Database Fundamentals (SQL vs NoSQL)", link: "https://www.mongodb.com/compare/sql-vs-nosql" }, { id: "terminal", name: "Command Line (Terminal)", link: "https://www.freecodecamp.org/news/command-line-for-beginners/" }, { id: "http", name: "HTTP Protocol and the Web", link: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview" }] },
                    { module: "Phase 5: The Software Lifecycle", topics: [{ id: "git", name: "Version Control with Git", link: "https://git-scm.com/book/en/v2" }, { id: "testes", name: "The Importance of Testing", link: "https://www.atlassian.com/continuous-delivery/software-testing/types-of-software-testing" }, { id: "debug", name: "Debugging", link: "https://www.freecodecamp.org/news/what-is-debugging-how-to-debug-code/" }, { id: "boaspraticas", name: "Best Practices (SOLID, DRY, KISS)", link: "https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-5-principles-of-object-oriented-design" }] },
                ]
            },
            js: {
                pt: [
                    { module: "N√≠vel 1: JavaScript Iniciante", topics: [{ name: "Configurando o Ambiente (Node.js, VS Code)", link: "https://code.visualstudio.com/docs/nodejs/nodejs-tutorial" }, { name: "Vari√°veis, Tipos e Operadores", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Grammar_and_types" }, { name: "Fun√ß√µes e Controle de Fluxo", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Functions" }, { name: "Manipula√ß√£o do DOM e Eventos", link: "https://developer.mozilla.org/pt-BR/docs/Learn/JavaScript/Building_blocks/Events" }] },
                    { module: "N√≠vel 2: JavaScript Intermedi√°rio", topics: [{ name: "Arrays e Objetos (M√©todos Avan√ßados)", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Array" }, { name: "POO (Prototypes, Classes)", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Working_with_Objects" }, { name: "Promises e Async/Await", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Using_promises" }, { name: "Consumindo APIs (Fetch)", link: "https://developer.mozilla.org/pt-BR/docs/Web/API/Fetch_API/Using_Fetch" }] },
                    { module: "N√≠vel 3: JavaScript Avan√ßado", topics: [{ name: "M√≥dulos (import/export)", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Modules" }, { name: "Programa√ß√£o Funcional (Composi√ß√£o, Currying)", link: "https://www.freecodecamp.org/news/functional-programming-in-javascript/" }, { name: "Estruturas de Dados em JS", link: "https://www.freecodecamp.org/news/data-structures-in-javascript-with-examples/" }, { name: "Event Loop e Concorr√™ncia", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/EventLoop" }] },
                    { module: "N√≠vel 4: Ecossistema e Especializa√ß√£o", topics: [{ name: "TypeScript", link: "https://www.typescriptlang.org/docs/" }, { name: "Backend com Node.js e Express", link: "https://expressjs.com/pt-br/starter/hello-world.html" }, { name: "Frontend com React (ou Vue/Angular)", link: "https://react.dev/learn" }, { name: "Testes (Jest, Cypress)", link: "https://jestjs.io/pt-BR/docs/getting-started" }, { name: "WebSockets e Performance", link: "https://developer.mozilla.org/pt-BR/docs/Web/API/WebSockets_API" }] }
                ],
                en: [
                    { module: "Level 1: Beginner JavaScript", topics: [{ name: "Setting up the Environment (Node.js, VS Code)", link: "https://code.visualstudio.com/docs/nodejs/nodejs-tutorial" }, { name: "Variables, Types, and Operators", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types" }, { name: "Functions and Control Flow", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Functions" }, { name: "DOM Manipulation and Events", link: "https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events" }] },
                    { module: "Level 2: Intermediate JavaScript", topics: [{ name: "Arrays and Objects (Advanced Methods)", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" }, { name: "OOP (Prototypes, Classes)", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Working_with_Objects" }, { name: "Promises and Async/Await", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises" }, { name: "Consuming APIs (Fetch)", link: "https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" }] },
                    { module: "Level 3: Advanced JavaScript", topics: [{ name: "Modules (import/export)", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" }, { name: "Functional Programming (Composition, Currying)", link: "https://www.freecodecamp.org/news/functional-programming-in-javascript/" }, { name: "Data Structures in JS", link: "https://www.freecodecamp.org/news/data-structures-in-javascript-with-examples/" }, { name: "Event Loop and Concurrency", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop" }] },
                    { module: "Level 4: Ecosystem and Specialization", topics: [{ name: "TypeScript", link: "https://www.typescriptlang.org/docs/" }, { name: "Backend with Node.js and Express", link: "https://expressjs.com/en/starter/hello-world.html" }, { name: "Frontend with React (or Vue/Angular)", link: "https://react.dev/learn" }, { name: "Testing (Jest, Cypress)", link: "https://jestjs.io/docs/getting-started" }, { name: "WebSockets and Performance", link: "https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" }] }
                ]
            },
            python: {
                pt: [
                    { module: "N√≠vel 1: Python Iniciante", topics: [{ name: "Instalando Python e VS Code", link: "https://code.visualstudio.com/docs/python/python-tutorial" }, { name: "Vari√°veis, Tipos e Operadores", link: "https://docs.python.org/pt-br/3/library/stdtypes.html" }, { name: "Estruturas de Dados (Listas, Tuplas, Dicion√°rios)", link: "https://docs.python.org/pt-br/3/tutorial/datastructures.html" }, { name: "Fun√ß√µes e Controle de Fluxo", link: "https://docs.python.org/pt-br/3/tutorial/controlflow.html#defining-functions" }] },
                    { module: "N√≠vel 2: Python Intermedi√°rio", topics: [{ name: "Programa√ß√£o Orientada a Objetos (POO)", link: "https://docs.python.org/pt-br/3/tutorial/classes.html" }, { name: "Manipula√ß√£o de Arquivos", link: "https://docs.python.org/pt-br/3/tutorial/inputoutput.html#reading-and-writing-files" }, { name: "M√≥dulos e Pacotes", link: "https://docs.python.org/pt-br/3/tutorial/modules.html" }, { name: "Ambientes Virtuais (venv) e Pip", link: "https://docs.python.org/pt-br/3/library/venv.html" }] },
                    { module: "N√≠vel 3: Python Avan√ßado", topics: [{ name: "List Comprehensions e Generators", link: "https://docs.python.org/pt-br/3/howto/functional.html" }, { name: "Decorators", link: "https://realpython.com/primer-on-python-decorators/" }, { name: "Programa√ß√£o Ass√≠ncrona (asyncio)", link: "https://docs.python.org/pt-br/3/library/asyncio.html" }, { name: "Testes com Pytest", link: "https://docs.pytest.org/en/stable/getting-started.html" }] },
                    { module: "N√≠vel 4: Ecossistema e Especializa√ß√£o", topics: [{ name: "Web com Django ou Flask", link: "https://www.djangoproject.com/start/" }, { name: "APIs com FastAPI", link: "https://fastapi.tiangolo.com/" }, { name: "Ci√™ncia de Dados (Pandas, NumPy, Scikit-learn)", link: "https://pandas.pydata.org/docs/getting_started/index.html" }, { name: "Machine Learning (TensorFlow, PyTorch)", link: "https://www.tensorflow.org/tutorials" }, { name: "Automa√ß√£o e Scripting", link: "https://automatetheboringstuff.com/" }] }
                ],
                en: [
                    { module: "Level 1: Beginner Python", topics: [{ name: "Installing Python and VS Code", link: "https://code.visualstudio.com/docs/python/python-tutorial" }, { name: "Variables, Types, and Operators", link: "https://docs.python.org/3/library/stdtypes.html" }, { name: "Data Structures (Lists, Tuples, Dictionaries)", link: "https://docs.python.org/3/tutorial/datastructures.html" }, { name: "Functions and Control Flow", link: "https://docs.python.org/3/tutorial/controlflow.html#defining-functions" }] },
                    { module: "Level 2: Intermediate Python", topics: [{ name: "Object-Oriented Programming (OOP)", link: "https://docs.python.org/3/tutorial/classes.html" }, { name: "File Handling", link: "https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files" }, { name: "Modules and Packages", link: "https://docs.python.org/3/tutorial/modules.html" }, { name: "Virtual Environments (venv) and Pip", link: "https://docs.python.org/3/library/venv.html" }] },
                    { module: "Level 3: Advanced Python", topics: [{ name: "List Comprehensions and Generators", link: "https://docs.python.org/3/howto/functional.html" }, { name: "Decorators", link: "https://realpython.com/primer-on-python-decorators/" }, { name: "Asynchronous Programming (asyncio)", link: "https://docs.python.org/3/library/asyncio.html" }, { name: "Testing with Pytest", link: "https://docs.pytest.org/en/stable/getting-started.html" }] },
                    { module: "Level 4: Ecosystem and Specialization", topics: [{ name: "Web with Django or Flask", link: "https://www.djangoproject.com/start/" }, { name: "APIs with FastAPI", link: "https://fastapi.tiangolo.com/" }, { name: "Data Science (Pandas, NumPy, Scikit-learn)", link: "https://pandas.pydata.org/docs/getting_started/index.html" }, { name: "Machine Learning (TensorFlow, PyTorch)", link: "https://www.tensorflow.org/tutorials" }, { name: "Automation and Scripting", link: "https://automatetheboringstuff.com/" }] }
                ]
            },
             csharp: {
                pt: [
                    { module: "N√≠vel 1: C# Iniciante", topics: [{ name: "Configurando o Ambiente (.NET, VS Code)", link: "https://learn.microsoft.com/pt-br/dotnet/core/install/" }, { name: "Vari√°veis, Tipos e Operadores", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/language-reference/builtin-types/value-types" }, { name: "M√©todos e Controle de Fluxo", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/programming-guide/classes-and-structs/methods" }, { name: "Arrays, Listas e Dicion√°rios", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/programming-guide/arrays/" }] },
                    { module: "N√≠vel 2: C# Intermedi√°rio", topics: [{ name: "Programa√ß√£o Orientada a Objetos (POO)", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/fundamentals/tutorials/oop" }, { name: "Interfaces e Classes Abstratas", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/language-reference/keywords/interface" }, { name: "Tratamento de Exce√ß√µes", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/language-reference/keywords/try-catch" }, { name: "Gerenciador de Pacotes (NuGet)", link: "https://learn.microsoft.com/pt-br/nuget/what-is-nuget" }] },
                    { module: "N√≠vel 3: C# Avan√ßado", topics: [{ name: "LINQ para Consultas", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/linq/" }, { name: "Generics", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/programming-guide/generics/" }, { name: "Programa√ß√£o Ass√≠ncrona (async/await)", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/asynchronous-programming/async-scenarios" }, { name: "Delegates, Eventos e Fun√ß√µes Lambda", link: "https://learn.microsoft.com/pt-br/dotnet/csharp/programming-guide/events/" }] },
                    { module: "N√≠vel 4: Ecossistema e Especializa√ß√£o", topics: [{ name: "APIs Web com ASP.NET Core", link: "https://learn.microsoft.com/pt-br/aspnet/core/tutorials/first-web-api" }, { name: "ORM com Entity Framework Core", link: "https://learn.microsoft.com/pt-br/ef/core/" }, { name: "Testes com xUnit", link: "https://xunit.net/docs/getting-started/netcore/cmdline" }, { name: "Microsservi√ßos e Integra√ß√£o com Azure", link: "https://azure.microsoft.com/pt-br/solutions/microservice-applications/" }, { name: "Desenvolvimento de Jogos com Unity", link: "https://learn.unity.com/" }] }
                ],
                en: [
                    { module: "Level 1: Beginner C#", topics: [{ name: "Setting up the Environment (.NET, VS Code)", link: "https://learn.microsoft.com/en-us/dotnet/core/install/" }, { name: "Variables, Types, and Operators", link: "https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/value-types" }, { name: "Methods and Control Flow", link: "https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/methods" }, { name: "Arrays, Lists, and Dictionaries", link: "https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/arrays/" }] },
                    { module: "Level 2: Intermediate C#", topics: [{ name: "Object-Oriented Programming (OOP)", link: "https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/tutorials/oop" }, { name: "Interfaces and Abstract Classes", link: "https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/interface" }, { name: "Exception Handling", link: "https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch" }, { name: "Package Manager (NuGet)", link: "https://learn.microsoft.com/en-us/nuget/what-is-nuget" }] },
                    { module: "Level 3: Advanced C#", topics: [{ name: "LINQ for Queries", link: "https://learn.microsoft.com/en-us/dotnet/csharp/linq/" }, { name: "Generics", link: "https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/" }, { name: "Asynchronous Programming (async/await)", link: "https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/async-scenarios" }, { name: "Delegates, Events, and Lambda Functions", link: "https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/events/" }] },
                    { module: "Level 4: Ecosystem and Specialization", topics: [{ name: "Web APIs with ASP.NET Core", link: "https://learn.microsoft.com/en-us/aspnet/core/tutorials/first-web-api" }, { name: "ORM with Entity Framework Core", link: "https://learn.microsoft.com/en-us/ef/core/" }, { name: "Testing with xUnit", link: "https://xunit.net/docs/getting-started/netcore/cmdline" }, { name: "Microservices and Azure Integration", link: "https://azure.microsoft.com/en-us/solutions/microservice-applications/" }, { name: "Game Development with Unity", link: "https://learn.unity.com/" }] }
                ]
            },
            java: {
                pt: [
                    { module: "N√≠vel 1: Java Iniciante", topics: [{ name: "Configurando o Ambiente (JDK, Maven, VS Code)", link: "https://code.visualstudio.com/docs/java/java-tutorial" }, { name: "Vari√°veis, Tipos e Operadores", link: "https://www.w3schools.com/java/java_variables.asp" }, { name: "M√©todos e Controle de Fluxo", link: "https://www.w3schools.com/java/java_methods.asp" }, { name: "Arrays e Estruturas de Repeti√ß√£o", link: "https://www.w3schools.com/java/java_arrays.asp" }] },
                    { module: "N√≠vel 2: Java Intermedi√°rio", topics: [{ name: "Programa√ß√£o Orientada a Objetos (POO)", link: "https://www.w3schools.com/java/java_oop.asp" }, { name: "Collections Framework (List, Set, Map)", link: "https://www.geeksforgeeks.org/collections-in-java-2/" }, { name: "Tratamento de Exce√ß√µes", link: "https://www.w3schools.com/java/java_try_catch.asp" }, { name: "Gerenciador de Depend√™ncias (Maven/Gradle)", link: "https://maven.apache.org/guides/getting-started/index.html" }] },
                    { module: "N√≠vel 3: Java Avan√ßado", topics: [{ name: "Streams API e Fun√ß√µes Lambda", link: "https://www.baeldung.com/java-8-streams" }, { name: "Generics", link: "https://docs.oracle.com/javase/tutorial/java/generics/index.html" }, { name: "Programa√ß√£o Concorrente (Threads)", link: "https://www.baeldung.com/java-concurrency" }, { name: "JDBC e Conex√£o com Banco de Dados", link: "https://www.javatpoint.com/java-jdbc" }] },
                    { module: "N√≠vel 4: Ecossistema e Especializa√ß√£o", topics: [{ name: "Framework Spring e Spring Boot", link: "https://spring.io/quickstart" }, { name: "ORM com Spring Data JPA / Hibernate", link: "https://spring.io/projects/spring-data-jpa" }, { name: "Testes com JUnit e Mockito", link: "https://junit.org/junit5/docs/current/user-guide/" }, { name: "Microsservi√ßos com Spring Cloud", link: "https://spring.io/projects/spring-cloud" }, { name: "Desenvolvimento Android", link: "https://developer.android.com/training/basics/firstapp" }] }
                ],
                en: [
                    { module: "Level 1: Beginner Java", topics: [{ name: "Setting up the Environment (JDK, Maven, VS Code)", link: "https://code.visualstudio.com/docs/java/java-tutorial" }, { name: "Variables, Types, and Operators", link: "https://www.w3schools.com/java/java_variables.asp" }, { name: "Methods and Control Flow", link: "https://www.w3schools.com/java/java_methods.asp" }, { name: "Arrays and Looping Structures", link: "https://www.w3schools.com/java/java_arrays.asp" }] },
                    { module: "Level 2: Intermediate Java", topics: [{ name: "Object-Oriented Programming (OOP)", link: "https://www.w3schools.com/java/java_oop.asp" }, { name: "Collections Framework (List, Set, Map)", link: "https://www.geeksforgeeks.org/collections-in-java-2/" }, { name: "Exception Handling", link: "https://www.w3schools.com/java/java_try_catch.asp" }, { name: "Dependency Management (Maven/Gradle)", link: "https://maven.apache.org/guides/getting-started/index.html" }] },
                    { module: "Level 3: Advanced Java", topics: [{ name: "Streams API and Lambda Functions", link: "https://www.baeldung.com/java-8-streams" }, { name: "Generics", link: "https://docs.oracle.com/javase/tutorial/java/generics/index.html" }, { name: "Concurrent Programming (Threads)", link: "https://www.baeldung.com/java-concurrency" }, { name: "JDBC and Database Connectivity", link: "https://www.javatpoint.com/java-jdbc" }] },
                    { module: "Level 4: Ecosystem and Specialization", topics: [{ name: "Spring Framework and Spring Boot", link: "https://spring.io/quickstart" }, { name: "ORM with Spring Data JPA / Hibernate", link: "https://spring.io/projects/spring-data-jpa" }, { name: "Unit Testing with JUnit and Mockito", link: "https://junit.org/junit5/docs/current/user-guide/" }, { name: "Microservices with Spring Cloud", link: "https://spring.io/projects/spring-cloud" }, { name: "Android Development", link: "https://developer.android.com/training/basics/firstapp" }] }
                ]
            },
            rust: {
                pt: [
                    { module: "N√≠vel 1: Rust Iniciante", topics: [{ name: "Instalando Rust (rustup) e Cargo", link: "https://www.rust-lang.org/tools/install" }, { name: "Vari√°veis, Tipos e Fun√ß√µes", link: "https://doc.rust-lang.org/book/ch03-00-common-programming-concepts.html" }, { name: "Ownership e Borrowing", link: "https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html" }, { name: "Structs e Enums", link: "https://doc.rust-lang.org/book/ch05-00-structs.html" }] },
                    { module: "N√≠vel 2: Rust Intermedi√°rio", topics: [{ name: "Cole√ß√µes (Vector, String, HashMap)", link: "https://doc.rust-lang.org/book/ch08-00-common-collections.html" }, { name: "Tratamento de Erros (Result, Option)", link: "https://doc.rust-lang.org/book/ch09-00-error-handling.html" }, { name: "Traits e Generics", link: "https://doc.rust-lang.org/book/ch10-00-generics.html" }, { name: "Testes em Rust", link: "https://doc.rust-lang.org/book/ch11-00-testing.html" }] },
                    { module: "N√≠vel 3: Rust Avan√ßado", topics: [{ name: "Lifetimes", link: "https://doc.rust-lang.org/book/ch10-03-lifetime-syntax.html" }, { name: "Closures e Iterators", link: "https://doc.rust-lang.org/book/ch13-00-functional-features.html" }, { name: "Smart Pointers", link: "https://doc.rust-lang.org/book/ch15-00-smart-pointers.html" }, { name: "Concorr√™ncia Segura", link: "https://doc.rust-lang.org/book/ch16-00-concurrency.html" }] },
                    { module: "N√≠vel 4: Ecossistema e Especializa√ß√£o", topics: [{ name: "Macros", link: "https://doc.rust-lang.org/book/ch19-06-macros.html" }, { name: "C√≥digo Inseguro (Unsafe Rust)", link: "https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html" }, { name: "APIs Web com Actix Web ou Rocket", link: "https://actix.rs/docs/getting-started" }, { name: "Aplica√ß√µes de Linha de Comando (CLI)", link: "https://rust-cli.github.io/book/index.html" }, { name: "WebAssembly (WASM)", link: "https://rustwasm.github.io/docs/book/" }] }
                ],
                en: [
                    { module: "Level 1: Beginner Rust", topics: [{ name: "Installing Rust (rustup) and Cargo", link: "https://www.rust-lang.org/tools/install" }, { name: "Variables, Types, and Functions", link: "https://doc.rust-lang.org/book/ch03-00-common-programming-concepts.html" }, { name: "Ownership and Borrowing", link: "https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html" }, { name: "Structs and Enums", link: "https://doc.rust-lang.org/book/ch05-00-structs.html" }] },
                    { module: "Level 2: Intermediate Rust", topics: [{ name: "Collections (Vector, String, HashMap)", link: "https://doc.rust-lang.org/book/ch08-00-common-collections.html" }, { name: "Error Handling (Result, Option)", link: "https://doc.rust-lang.org/book/ch09-00-error-handling.html" }, { name: "Traits and Generics", link: "https://doc.rust-lang.org/book/ch10-00-generics.html" }, { name: "Testing in Rust", link: "https://doc.rust-lang.org/book/ch11-00-testing.html" }] },
                    { module: "Level 3: Advanced Rust", topics: [{ name: "Lifetimes", link: "https://doc.rust-lang.org/book/ch10-03-lifetime-syntax.html" }, { name: "Closures and Iterators", link: "https://doc.rust-lang.org/book/ch13-00-functional-features.html" }, { name: "Smart Pointers", link: "https://doc.rust-lang.org/book/ch15-00-smart-pointers.html" }, { name: "Fearless Concurrency", link: "https://doc.rust-lang.org/book/ch16-00-concurrency.html" }] },
                    { module: "Level 4: Ecosystem and Specialization", topics: [{ name: "Macros", link: "https://doc.rust-lang.org/book/ch19-06-macros.html" }, { name: "Unsafe Rust", link: "https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html" }, { name: "Web APIs with Actix Web or Rocket", link: "https://actix.rs/docs/getting-started" }, { name: "Command-Line (CLI) Applications", link: "https://rust-cli.github.io/book/index.html" }, { name: "WebAssembly (WASM)", link: "https://rustwasm.github.io/docs/book/" }] }
                ]
            }
        };

        const translations = {
            pt: {
                mainTitle: "Plano de Estudos de Programa√ß√£o",
                mainSubtitle: "Sua jornada do b√°sico ao avan√ßado com acompanhamento de progresso e anota√ß√µes.",
                progressTitle: "Meu Progresso no Plano Geral",
                tabGeneral: "Plano Geral",
                aiAssistantTitle: "Assistente IA",
                chatPlaceholder: "Pergunte algo sobre programa√ß√£o...",
                sendButton: "Enviar",
                modalTitle: "Configurar Chave de API",
                modalDesc: "Para usar o Assistente IA, voc√™ precisa de uma chave de API do Google AI Studio. √â gr√°tis para come√ßar.",
                modalSteps: [`Acesse o <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 underline">Google AI Studio</a>.`, `Clique em "Create API key".`, `Copie a chave gerada e cole no campo abaixo.`],
                modalApiKeyPlaceholder: "Cole sua chave de API aqui",
                modalCancel: "Cancelar",
                modalSave: "Salvar",
                notesButton: "Adicionar/Ver Anota√ß√µes",
                notesPlaceholder: "Suas anota√ß√µes sobre este m√≥dulo...",
                resourceButton: "Acessar Recurso",
                footerText: "Este site foi criado para ajudar programadores novatos a alcan√ßar seus objetivos. N√£o somos remunerados por isso, nosso √∫nico desejo √© oferecer uma √≥tima experi√™ncia aos usu√°rios.",
                systemMsgApiKeySaved: "Chave de API salva com sucesso!",
                systemMsgApiKeyNeeded: "Por favor, configure sua chave de API do Google AI nas configura√ß√µes (‚öôÔ∏è) para usar o assistente.",
                systemMsgWelcome: "Bem-vindo! Para come√ßar, configure sua chave de API do Google AI nas configura√ß√µes (‚öôÔ∏è) no canto superior direito.",
                systemMsgReady: "Assistente pronto! Fa√ßa sua pergunta.",
                systemMsgError: "Ocorreu um erro. Verifique se sua chave de API est√° correta e se h√° conex√£o com a internet.",
                systemMsgNoResponse: "Desculpe, n√£o consegui gerar uma resposta."
            },
            en: {
                mainTitle: "Programming Study Plan",
                mainSubtitle: "Your journey from basic to advanced with progress tracking and notes.",
                progressTitle: "My Progress on the General Plan",
                tabGeneral: "General Plan",
                aiAssistantTitle: "AI Assistant",
                chatPlaceholder: "Ask something about programming...",
                sendButton: "Send",
                modalTitle: "Set API Key",
                modalDesc: "To use the AI Assistant, you need an API key from Google AI Studio. It's free to get started.",
                modalSteps: [`Go to <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 underline">Google AI Studio</a>.`, `Click "Create API key".`, `Copy the generated key and paste it in the field below.`],
                modalApiKeyPlaceholder: "Paste your API key here",
                modalCancel: "Cancel",
                modalSave: "Save",
                notesButton: "Add/View Notes",
                notesPlaceholder: "Your notes on this module...",
                resourceButton: "Access Resource",
                footerText: "This site was created to help novice programmers achieve their goals. We are not compensated for this; our only wish is to provide a great experience for users.",
                systemMsgApiKeySaved: "API Key saved successfully!",
                systemMsgApiKeyNeeded: "Please set your Google AI API key in the settings (‚öôÔ∏è) to use the assistant.",
                systemMsgWelcome: "Welcome! To get started, set your Google AI API key in the settings (‚öôÔ∏è) in the top right corner.",
                systemMsgReady: "Assistant ready! Ask your question.",
                systemMsgError: "An error occurred. Check if your API key is correct and if you have an internet connection.",
                systemMsgNoResponse: "Sorry, I couldn't generate a response."
            }
        };

        class StudyApp {
            constructor() {
                this.studyProgress = {};
                this.apiKey = '';
                this.currentLang = 'pt';
                this.currentTab = 'general';
                this.elements = {
                    mainTitle: document.getElementById('main-title'),
                    mainSubtitle: document.getElementById('main-subtitle'),
                    langSwitcher: document.getElementById('lang-switcher'),
                    progressTitle: document.getElementById('progress-title'),
                    progressBar: document.getElementById('progressBar'),
                    tabSelector: document.getElementById('tab-selector'),
                    modulesContainer: document.getElementById('modulesContainer'),
                    footerText: document.getElementById('footer-text'),
                    aiPanel: document.getElementById('ai-assistant'),
                    toggleAiBtn: document.getElementById('toggle-ai'),
                    closeAiBtn: document.getElementById('close-ai'),
                    aiAssistantTitle: document.getElementById('ai-assistant-title'),
                    chatMessages: document.getElementById('chat-messages'),
                    chatInput: document.getElementById('chat-input'),
                    sendBtn: document.getElementById('send-btn'),
                    settingsBtn: document.getElementById('settings-btn'),
                    apiKeyModal: document.getElementById('api-key-modal'),
                    modalTitle: document.getElementById('modal-title'),
                    modalDesc: document.getElementById('modal-desc'),
                    modalSteps: document.getElementById('modal-steps'),
                    apiKeyInput: document.getElementById('api-key-input'),
                    modalApiKeyPlaceholder: document.getElementById('api-key-input'),
                    saveApiKeyBtn: document.getElementById('save-api-key'),
                    cancelApiKeyBtn: document.getElementById('cancel-api-key'),
                    infoModal: document.getElementById('info-modal'),
                    infoModalTitle: document.getElementById('info-modal-title'),
                    infoModalContent: document.getElementById('info-modal-content'),
                    closeInfoModalBtn: document.getElementById('close-info-modal'),
                };
                this.init();
            }

            init() {
                this.loadData();
                this.renderTabs();
                this.applyTranslations();
                this.renderModules();
                this.addEventListeners();
                this.initAIChat();
                this.updateActiveTab();
            }

            loadData() {
                this.currentLang = localStorage.getItem('currentLanguage') || 'pt';
                this.currentTab = localStorage.getItem('currentTab') || 'general';
                this.apiKey = localStorage.getItem('googleApiKey') || '';
                const savedProgress = JSON.parse(localStorage.getItem('studyProgress')) || {};

                const generalStructure = contentData.general.pt;
                if (!savedProgress.general || savedProgress.general.length !== generalStructure.length) {
                    savedProgress.general = generalStructure.map(mod => ({
                        notes: "",
                        topics: mod.topics.map(() => ({ completed: false }))
                    }));
                }
                this.studyProgress = savedProgress;
            }

            saveData() {
                localStorage.setItem('studyProgress', JSON.stringify(this.studyProgress));
                localStorage.setItem('googleApiKey', this.apiKey);
                localStorage.setItem('currentLanguage', this.currentLang);
                localStorage.setItem('currentTab', this.currentTab);
            }

            applyTranslations() {
                const t = translations[this.currentLang];
                document.documentElement.lang = this.currentLang;
                Object.keys(this.elements).forEach(key => {
                    if (t[key] && this.elements[key]) this.elements[key].textContent = t[key];
                });
                this.elements.chatInput.placeholder = t.chatPlaceholder;
                this.elements.modalApiKeyPlaceholder.placeholder = t.modalApiKeyPlaceholder;
                this.elements.modalSteps.innerHTML = t.modalSteps.map(item => `<li>${item}</li>`).join('');
                this.renderTabs();
            }

            updateProgress() {
                const generalProgress = this.studyProgress.general;
                if (!generalProgress) return;
                const allTopics = generalProgress.flatMap(module => module.topics);
                const completedTopics = allTopics.filter(topic => topic.completed).length;
                const totalTopics = allTopics.length;
                const percentage = totalTopics > 0 ? Math.round((completedTopics / totalTopics) * 100) : 0;
                
                this.elements.progressBar.style.width = `${percentage}%`;
                this.elements.progressBar.textContent = `${percentage}%`;
            }
            
            renderTabs() {
                const t = translations[this.currentLang];
                const tabs = [
                    { id: 'general', name: t.tabGeneral },
                    { id: 'js', name: 'JavaScript' },
                    { id: 'python', name: 'Python' },
                    { id: 'csharp', name: 'C#' },
                    { id: 'java', name: 'Java' },
                    { id: 'rust', name: 'Rust' },
                ];
                this.elements.tabSelector.innerHTML = tabs.map(tab => `
                    <button data-tab="${tab.id}" class="tab-button flex-grow text-center py-2 px-4 rounded-md font-semibold text-slate-700 -mb-px border border-transparent">
                        ${tab.name}
                    </button>
                `).join('');
                this.updateActiveTab();
            }

            renderModules() {
                const t = translations[this.currentLang];
                const plan = contentData[this.currentTab][this.currentLang];
                const isGeneralPlan = this.currentTab === 'general';
                
                this.elements.modulesContainer.innerHTML = '';
                plan.forEach((moduleData, moduleIndex) => {
                    const moduleEl = document.createElement('div');
                    moduleEl.className = 'bg-white p-6 rounded-xl shadow-sm border border-slate-200';

                    const topicsHtml = moduleData.topics.map((topic, topicIndex) => {
                        const topicName = typeof topic === 'string' ? topic : topic.name;
                        const topicLink = topic.link || null;
                        
                        let topicContentHtml = `<a href="${topicLink}" target="_blank" rel="noopener noreferrer" class="ml-3 text-indigo-600 hover:underline flex-grow">${topicName}</a>`;
                        
                        if (isGeneralPlan) {
                            const progress = this.studyProgress.general[moduleIndex].topics[topicIndex];
                            return `
                                <div class="flex items-center py-2 border-b border-slate-100 last:border-b-0">
                                    <label for="topic-${moduleIndex}-${topicIndex}" class="flex items-center cursor-pointer w-full">
                                        <input id="topic-${moduleIndex}-${topicIndex}" type="checkbox" class="h-5 w-5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 custom-checkbox" ${progress.completed ? 'checked' : ''} data-module="${moduleIndex}" data-topic="${topicIndex}">
                                        ${topicContentHtml}
                                    </label>
                                </div>`;
                        } else {
                             let nonGeneralTopicHtml = `<span class="ml-3 text-slate-700 flex-grow">${topicName}</span>`;
                            if (topicLink) {
                                nonGeneralTopicHtml += `<a href="${topicLink}" target="_blank" rel="noopener noreferrer" class="ml-4 text-sm text-indigo-600 hover:text-indigo-800 font-medium shrink-0">${t.resourceButton}</a>`;
                            }
                            return `<div class="flex items-center py-2 border-b border-slate-100 last:border-b-0">${nonGeneralTopicHtml}</div>`;
                        }
                    }).join('');
                    
                    let notesHtml = '';
                    if (isGeneralPlan) {
                         notesHtml = `
                            <div class="mt-4 pt-4 border-t border-slate-200">
                                <button class="text-sm text-indigo-600 hover:text-indigo-800 font-medium" data-notes-toggle="${moduleIndex}">${t.notesButton}</button>
                                <div id="notes-container-${moduleIndex}" class="notes-container">
                                    <textarea class="w-full h-24 p-2 border border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="${t.notesPlaceholder}" data-notes-input="${moduleIndex}">${this.studyProgress.general[moduleIndex].notes || ''}</textarea>
                                </div>
                            </div>`;
                    }

                    moduleEl.innerHTML = `
                        <h3 class="text-2xl font-semibold mb-4 text-slate-800">${moduleData.module}</h3>
                        <div class="space-y-2">${topicsHtml}</div>
                        ${notesHtml}`;
                    this.elements.modulesContainer.appendChild(moduleEl);
                });
                if(isGeneralPlan) this.updateProgress();
            }
            
            updateActiveTab() {
                this.elements.tabSelector.querySelectorAll('.tab-button').forEach(tab => {
                    tab.classList.remove('active', 'border-slate-300', 'bg-white');
                    if (tab.dataset.tab === this.currentTab) {
                        tab.classList.add('active');
                    }
                });
            }

            addEventListeners() {
                this.elements.modulesContainer.addEventListener('change', (e) => {
                    if (e.target.matches('input[type="checkbox"]') && this.currentTab === 'general') {
                        const { module, topic } = e.target.dataset;
                        this.studyProgress.general[module].topics[topic].completed = e.target.checked;
                        this.saveData();
                        this.updateProgress();
                    }
                });

                this.elements.modulesContainer.addEventListener('input', (e) => {
                    if (e.target.matches('textarea[data-notes-input]') && this.currentTab === 'general') {
                        const { notesInput } = e.target.dataset;
                        this.studyProgress.general[notesInput].notes = e.target.value;
                        this.saveData();
                    }
                });

                this.elements.modulesContainer.addEventListener('click', (e) => {
                    if (e.target.matches('button[data-notes-toggle]')) {
                        const { notesToggle } = e.target.dataset;
                        document.getElementById(`notes-container-${notesToggle}`).classList.toggle('open');
                    }
                });
                
                this.elements.langSwitcher.addEventListener('click', () => {
                    this.currentLang = this.currentLang === 'pt' ? 'en' : 'pt';
                    this.saveData();
                    this.applyTranslations();
                    this.renderModules();
                });
                
                this.elements.tabSelector.addEventListener('click', (e) => {
                    if(e.target.matches('.tab-button')) {
                        this.currentTab = e.target.dataset.tab;
                        this.saveData();
                        this.renderModules();
                        this.updateActiveTab();
                    }
                });

                this.elements.toggleAiBtn.addEventListener('click', () => this.elements.aiPanel.classList.remove('translate-x-full'));
                this.elements.closeAiBtn.addEventListener('click', () => this.elements.aiPanel.classList.add('translate-x-full'));
                this.elements.settingsBtn.addEventListener('click', () => {
                    this.elements.apiKeyInput.value = this.apiKey;
                    this.elements.apiKeyModal.style.display = 'flex';
                });
                this.elements.cancelApiKeyBtn.addEventListener('click', () => this.elements.apiKeyModal.style.display = 'none');
                this.elements.saveApiKeyBtn.addEventListener('click', () => {
                    const newApiKey = this.elements.apiKeyInput.value.trim();
                    if (newApiKey) {
                        this.apiKey = newApiKey;
                        this.saveData();
                        this.elements.apiKeyModal.style.display = 'none';
                        this.addMessage('system', translations[this.currentLang].systemMsgApiKeySaved);
                    }
                });
                this.elements.sendBtn.addEventListener('click', () => this.handleSendMessage());
                this.elements.chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') this.handleSendMessage();
                });
            }

            addMessage(sender, text, isHtml = false) {
                const messageEl = document.createElement('div');
                let messageClasses = 'p-3 rounded-lg max-w-xs break-words';
                if (sender === 'user') {
                    messageClasses += ' bg-indigo-500 text-white self-end';
                } else if (sender === 'ai') {
                    messageClasses += ' bg-slate-200 text-slate-800 self-start message-content';
                } else { // System message
                    messageClasses += ' bg-yellow-100 text-yellow-800 self-center text-sm w-full text-center';
                }
                messageEl.className = messageClasses;
                
                if (isHtml) {
                    messageEl.innerHTML = text;
                } else {
                    messageEl.textContent = text;
                }

                this.elements.chatMessages.appendChild(messageEl);
                this.elements.chatMessages.scrollTop = this.elements.chatMessages.scrollHeight;
                return messageEl;
            }

            async handleSendMessage() {
                const userPrompt = this.elements.chatInput.value.trim();
                const t = translations[this.currentLang];
                if (!userPrompt) return;

                if (!this.apiKey) {
                    this.addMessage('system', t.systemMsgApiKeyNeeded);
                    this.elements.apiKeyModal.style.display = 'flex';
                    return;
                }

                this.addMessage('user', userPrompt);
                this.elements.chatInput.value = '';
                
                const thinkingMessage = this.addMessage('ai', '<div class="spinner"></div>', true);

                try {
                    const payload = {
                        contents: [{
                            role: "user",
                            parts: [{ text: `You are a friendly and helpful programming tutor. Answer the following question clearly using Markdown and with code examples, if applicable: ${userPrompt}` }]
                        }]
                    };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${this.apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`API error: ${response.status} ${response.statusText}`);

                    const result = await response.json();
                    
                    if (result.candidates?.[0]?.content.parts?.[0]?.text) {
                        const aiText = result.candidates[0].content.parts[0].text;
                        thinkingMessage.innerHTML = marked.parse(aiText);
                    } else {
                        thinkingMessage.textContent = t.systemMsgNoResponse;
                    }
                } catch (error) {
                    console.error("Error calling AI API:", error);
                    thinkingMessage.textContent = t.systemMsgError;
                }
            }
            
            initAIChat() {
                const t = translations[this.currentLang];
                this.elements.chatMessages.innerHTML = ''; // Clear previous messages
                if (!this.apiKey) {
                    this.addMessage('system', t.systemMsgWelcome);
                } else {
                    this.addMessage('system', t.systemMsgReady);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => new StudyApp());
    </script>
</body>
</html>
