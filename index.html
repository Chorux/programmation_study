<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilha de Estudos de Programa√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .custom-checkbox:checked {
            background-color: #4F46E5;
            border-color: #4F46E5;
        }
        .custom-checkbox:checked + span {
            text-decoration: line-through;
            color: #6B7280;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .notes-container {
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
        }
        .notes-container.open {
            max-height: 200px;
            padding-top: 1rem;
        }
        #ai-assistant {
            transition: transform 0.3s ease-in-out;
        }
        .message-ai .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Estilos para o conte√∫do formatado em Markdown */
        .message-content pre {
            background-color: #1E293B;
            color: #E2E8F0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .message-content code {
            font-family: 'Courier New', Courier, monospace;
        }
        .message-content p {
            margin-bottom: 0.5rem;
        }
        .message-content h1, .message-content h2, .message-content h3 {
            font-weight: 600;
            margin-bottom: 0.5rem;
            margin-top: 1rem;
        }
        .message-content ul, .message-content ol {
            margin-left: 1.5rem;
            margin-bottom: 0.5rem;
            list-style: revert;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="relative min-h-screen">
        <!-- Main Content -->
        <main class="container mx-auto p-4 sm:p-6 lg:p-8">
            <header class="text-center mb-8 relative">
                <h1 id="main-title" class="text-4xl font-bold text-slate-900"></h1>
                <p id="main-subtitle" class="text-slate-600 mt-2"></p>
                <button id="lang-switcher" class="absolute top-0 right-0 bg-slate-200 text-slate-700 px-3 py-1 rounded-md text-sm font-medium hover:bg-slate-300 transition">
                    EN / PT
                </button>
            </header>

            <!-- Se√ß√£o de Progresso Geral -->
            <div class="mb-10 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 id="progress-title" class="text-2xl font-semibold mb-4 text-slate-800"></h2>
                <div class="w-full bg-slate-200 rounded-full h-6">
                    <div id="progressBar" class="bg-indigo-600 h-6 rounded-full text-center text-white text-sm font-medium leading-6 progress-bar-fill" style="width: 0%;">
                        0%
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o de Rotinas -->
            <div class="mb-10">
                <h2 id="routines-title" class="text-3xl font-bold text-center mb-6 text-slate-900"></h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h3 id="daily-routine-title" class="text-xl font-semibold mb-3 text-indigo-700"></h3>
                        <ul id="daily-routine-list" class="space-y-2 text-slate-600 list-disc list-inside"></ul>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h3 id="weekly-routine-title" class="text-xl font-semibold mb-3 text-indigo-700"></h3>
                        <ul id="weekly-routine-list" class="space-y-2 text-slate-600 list-disc list-inside"></ul>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h3 id="monthly-routine-title" class="text-xl font-semibold mb-3 text-indigo-700"></h3>
                        <ul id="monthly-routine-list" class="space-y-2 text-slate-600 list-disc list-inside"></ul>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do dos M√≥dulos de Estudo -->
            <div id="modulesContainer" class="space-y-6">
                <!-- Os m√≥dulos ser√£o inseridos aqui pelo JavaScript -->
            </div>
        </main>

        <!-- AI Assistant Panel -->
        <div id="ai-assistant" class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-lg transform translate-x-full z-50 flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50">
                <h2 id="ai-assistant-title" class="text-xl font-semibold text-slate-800"></h2>
                <div class="flex items-center gap-2">
                    <button id="settings-btn" class="p-2 rounded-full hover:bg-slate-200 text-xl leading-none" title="Configura√ß√µes">‚öôÔ∏è</button>
                    <button id="close-ai" class="p-2 rounded-full hover:bg-slate-200 text-2xl leading-none" title="Fechar">&times;</button>
                </div>
            </div>
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4 flex flex-col"></div>
            <div class="p-4 border-t bg-slate-50">
                <div class="flex gap-2">
                    <input id="chat-input" type="text" class="w-full p-2 border border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    <button id="send-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"></button>
                </div>
            </div>
        </div>

        <!-- API Key Modal -->
        <div id="api-key-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[100]">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md mx-4">
                <h3 id="modal-title" class="text-lg font-bold mb-4"></h3>
                <p id="modal-desc" class="text-sm text-slate-600 mb-4"></p>
                <ol id="modal-steps" class="text-sm text-slate-600 mb-4 list-decimal list-inside space-y-1"></ol>
                <input id="api-key-input" type="password" class="w-full p-2 border border-slate-300 rounded-md mb-4">
                <div class="flex justify-end gap-2">
                    <button id="cancel-api-key" class="px-4 py-2 bg-slate-200 rounded-md hover:bg-slate-300"></button>
                    <button id="save-api-key" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"></button>
                </div>
            </div>
        </div>

        <!-- Floating Toggle Button -->
        <button id="toggle-ai" class="fixed bottom-8 right-8 bg-indigo-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center text-3xl z-40 hover:bg-indigo-700 transition">ü§ñ</button>
    </div>

    <script>
        const translations = {
            pt: {
                mainTitle: "Plano de Estudos de Programa√ß√£o",
                mainSubtitle: "Sua jornada do b√°sico ao avan√ßado com acompanhamento de progresso e anota√ß√µes.",
                progressTitle: "Meu Progresso Geral",
                routinesTitle: "Rotinas de Estudo",
                dailyRoutineTitle: "Di√°ria",
                dailyRoutineList: ["1-2 horas de estudo focado.", "30 min de pr√°tica (CodeWars, LeetCode).", "Revisar o que foi estudado no dia anterior."],
                weeklyRoutineTitle: "Semanal",
                weeklyRoutineList: ["Definir 1-2 metas principais para a semana.", "Trabalhar em um mini-projeto pr√°tico.", "Revisar todos os t√≥picos da semana no s√°bado."],
                monthlyRoutineTitle: "Mensal",
                monthlyRoutineList: ["Concluir um m√≥dulo ou um projeto maior.", "Avaliar o progresso e reajustar o plano.", "Aprender uma nova ferramenta ou tecnologia."],
                aiAssistantTitle: "Assistente IA",
                chatPlaceholder: "Pergunte algo sobre programa√ß√£o...",
                sendButton: "Enviar",
                modalTitle: "Configurar Chave de API",
                modalDesc: "Para usar o Assistente IA, voc√™ precisa de uma chave de API do Google AI Studio. √â gr√°tis para come√ßar.",
                modalSteps: [`Acesse o <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 underline">Google AI Studio</a>.`, `Clique em "Create API key".`, `Copie a chave gerada e cole no campo abaixo.`],
                modalApiKeyPlaceholder: "Cole sua chave de API aqui",
                modalCancel: "Cancelar",
                modalSave: "Salvar",
                notesButton: "Adicionar/Ver Anota√ß√µes",
                notesPlaceholder: "Suas anota√ß√µes sobre este m√≥dulo...",
                resourceButton: "Acessar Recurso",
                systemMsgApiKeySaved: "Chave de API salva com sucesso!",
                systemMsgApiKeyNeeded: "Por favor, configure sua chave de API do Google AI nas configura√ß√µes (‚öôÔ∏è) para usar o assistente.",
                systemMsgWelcome: "Bem-vindo! Para come√ßar, configure sua chave de API do Google AI nas configura√ß√µes (‚öôÔ∏è) no canto superior direito.",
                systemMsgReady: "Assistente pronto! Fa√ßa sua pergunta.",
                systemMsgError: "Ocorreu um erro. Verifique se sua chave de API est√° correta e se h√° conex√£o com a internet.",
                systemMsgNoResponse: "Desculpe, n√£o consegui gerar uma resposta.",
                studyPlan: [
                    { module: "M√≥dulo 1: Fundamentos Essenciais", topics: [{ name: "L√≥gica de Programa√ß√£o e Algoritmos", link: "https://www.cursoemvideo.com/course/curso-de-algoritmos/" }, { name: "Tipos de Dados e Vari√°veis", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Grammar_and_types" }, { name: "Operadores (Aritm√©ticos, L√≥gicos, Compara√ß√£o)", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Expressions_and_Operators" }, { name: "Estruturas Condicionais (if, else, switch)", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Control_flow_and_error_handling" }, { name: "Estruturas de Repeti√ß√£o (for, while)", link: "https://www.w3schools.com/js/js_loop_for.asp" }] },
                    { module: "M√≥dulo 2: Linguagem de Programa√ß√£o (Base)", topics: ["Sintaxe B√°sica e Ambiente (Python/JavaScript)", { name: "Fun√ß√µes, Par√¢metros e Retorno", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Functions" }, "Escopo de Vari√°veis (Global, Local)", { name: "Estruturas de Dados Nativas (Listas/Arrays, Dicion√°rios/Objetos)", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Array" }, "Manipula√ß√£o de Strings e N√∫meros", { name: "Tratamento de Erros e Exce√ß√µes (try...catch)", link: "https://www.w3schools.com/js/js_errors.asp" }] },
                    { module: "M√≥dulo 3: Estruturas de Dados", topics: [{ name: "Arrays e Matrizes", link: "https://www.geeksforgeeks.org/array-data-structure/" }, { name: "Pilhas (Stacks)", link: "https://www.geeksforgeeks.org/stack-data-structure/" }, { name: "Filas (Queues)", link: "https://www.geeksforgeeks.org/queue-data-structure/" }, { name: "Listas Encadeadas (Singly, Doubly)", link: "https://www.geeksforgeeks.org/data-structures/linked-list/" }, { name: "√Årvores (Bin√°rias, de Busca - BST)", link: "https://www.geeksforgeeks.org/binary-search-tree-data-structure/" }, "Heaps (Min/Max Heap)", { name: "Tabelas Hash (Hashmaps)", link: "https://www.geeksforgeeks.org/hashing-data-structure/" }, "Grafos (Conceitos e Representa√ß√µes)", "Tries (√Årvore de prefixos)"] },
                    { module: "M√≥dulo 4: Algoritmos Avan√ßados", topics: [{ name: "An√°lise de Complexidade (Big O Notation)", link: "https://www.geeksforgeeks.org/analysis-algorithms-big-o-analysis/" }, "Estrat√©gia 'Dividir e Conquistar'", { name: "Algoritmos de Busca (Linear, Bin√°ria)", link: "https://www.khanacademy.org/computing/computer-science/algorithms/binary-search/a/binary-search" }, { name: "Algoritmos de Ordena√ß√£o (Bubble, Selection, Insertion, Merge, Quick Sort)", link: "https://www.geeksforgeeks.org/sorting-algorithms/" }, "Recursividade Avan√ßada", "Programa√ß√£o Din√¢mica (Conceitos)", "Algoritmos Gulosos (Greedy)"] },
                    { module: "M√≥dulo 5: Paradigmas de Programa√ß√£o", topics: [{ name: "Programa√ß√£o Orientada a Objetos (Classes, Heran√ßa, Polimorfismo, Encapsulamento)", link: "https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Guide/Details_of_the_Object_Model" }, { name: "Programa√ß√£o Funcional (Fun√ß√µes Puras, Imutabilidade, High-Order Functions)", link: "https://www.geeksforgeeks.org/functional-programming-paradigm/" }, "Programa√ß√£o procedural vs declarativa", { name: "Design Patterns (Padr√µes de Projeto): Singleton, Factory, Observer", link: "https://refactoring.guru/design-patterns" }] },
                    { module: "M√≥dulo 6: Banco de Dados", topics: ["Conceitos de Banco de Dados Relacionais", { name: "Linguagem SQL (SELECT, INSERT, UPDATE, DELETE, JOINs)", link: "https://www.w3schools.com/sql/" }, "Modelagem de Dados (Entidade-Relacionamento)", { name: "Conceitos de Banco de Dados NoSQL (Documental, Chave-Valor, Colunar)", link: "https://www.mongodb.com/nosql-explained" }, "ORM (Object-Relational Mapping) - Conceitos e Pr√°tica", "Transa√ß√µes (ACID)"] },
                    { module: "M√≥dulo 7: Ferramentas e Boas Pr√°ticas", topics: [{ name: "Controle de Vers√£o com Git e GitHub", link: "https://git-scm.com/book/pt-br/v2" }, "Linha de Comando (Terminal/Shell)", { name: "Gerenciadores de Pacotes (NPM/Yarn, Pip)", link: "https://docs.npmjs.com/about-npm" }, { name: "Testes de Software (Unit√°rios, Integra√ß√£o, E2E)", link: "https://www.atlassian.com/continuous-delivery/software-testing/types-of-software-testing" }, { name: "Princ√≠pios de Design (SOLID, DRY, KISS)", link: "https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-5-principles-of-object-oriented-design" }, "Depura√ß√£o (Debugging) de C√≥digo", { name: "APIs REST (Conceitos, M√©todos HTTP, Consumo)", link: "https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" }, "CI/CD - Integra√ß√£o e Entrega Cont√≠nua (Conceitos)"] },
                    { module: "M√≥dulo 8: T√≥picos Avan√ßados e Especializa√ß√£o", topics: ["Concorr√™ncia e Paralelismo (Threads, Async/Await)", "Arquitetura de Software (Monolito, Microsservi√ßos, Serverless)", { name: "Seguran√ßa da Informa√ß√£o (OWASP Top 10)", link: "https://owasp.org/www-project-top-ten/" }, { name: "Cloud Computing (AWS/Azure/GCP - Conceitos)", link: "https://aws.amazon.com/what-is-cloud-computing/" }, { name: "Containers (Docker - Conceitos e Pr√°tica)", link: "https://www.docker.com/get-started/" }, "Filas de Mensagens (RabbitMQ/Kafka - Conceitos)", "WebSockets e GraphQL", { name: "Explorar Roadmap Completo de Backend", link: "https://roadmap.sh/backend" }] }
                ]
            },
            en: {
                mainTitle: "Programming Study Plan",
                mainSubtitle: "Your journey from basic to advanced with progress tracking and notes.",
                progressTitle: "My Overall Progress",
                routinesTitle: "Study Routines",
                dailyRoutineTitle: "Daily",
                dailyRoutineList: ["1-2 hours of focused study.", "30 min of practice (CodeWars, LeetCode).", "Review what was studied the day before."],
                weeklyRoutineTitle: "Weekly",
                weeklyRoutineList: ["Set 1-2 main goals for the week.", "Work on a practical mini-project.", "Review all topics of the week on Saturday."],
                monthlyRoutineTitle: "Monthly",
                monthlyRoutineList: ["Complete a module or a larger project.", "Evaluate progress and readjust the plan.", "Learn a new tool or technology."],
                aiAssistantTitle: "AI Assistant",
                chatPlaceholder: "Ask something about programming...",
                sendButton: "Send",
                modalTitle: "Set API Key",
                modalDesc: "To use the AI Assistant, you need an API key from Google AI Studio. It's free to get started.",
                modalSteps: [`Go to <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 underline">Google AI Studio</a>.`, `Click "Create API key".`, `Copy the generated key and paste it in the field below.`],
                modalApiKeyPlaceholder: "Paste your API key here",
                modalCancel: "Cancel",
                modalSave: "Save",
                notesButton: "Add/View Notes",
                notesPlaceholder: "Your notes on this module...",
                resourceButton: "Access Resource",
                systemMsgApiKeySaved: "API Key saved successfully!",
                systemMsgApiKeyNeeded: "Please set your Google AI API key in the settings (‚öôÔ∏è) to use the assistant.",
                systemMsgWelcome: "Welcome! To get started, set your Google AI API key in the settings (‚öôÔ∏è) in the top right corner.",
                systemMsgReady: "Assistant ready! Ask your question.",
                systemMsgError: "An error occurred. Check if your API key is correct and if you have an internet connection.",
                systemMsgNoResponse: "Sorry, I couldn't generate a response.",
                studyPlan: [
                    { module: "Module 1: Essential Fundamentals", topics: [{ name: "Programming Logic and Algorithms", link: "https://www.geeksforgeeks.org/introduction-to-algorithms/" }, { name: "Data Types and Variables", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types" }, { name: "Operators (Arithmetic, Logical, Comparison)", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Expressions_and_Operators" }, { name: "Conditional Statements (if, else, switch)", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Control_flow_and_error_handling" }, { name: "Looping Structures (for, while)", link: "https://www.w3schools.com/js/js_loop_for.asp" }] },
                    { module: "Module 2: Programming Language (Base)", topics: ["Basic Syntax and Environment (Python/JavaScript)", { name: "Functions, Parameters, and Return", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Functions" }, "Variable Scope (Global, Local)", { name: "Native Data Structures (Lists/Arrays, Dictionaries/Objects)", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" }, "String and Number Manipulation", { name: "Error and Exception Handling (try...catch)", link: "https://www.w3schools.com/js/js_errors.asp" }] },
                    { module: "Module 3: Data Structures", topics: [{ name: "Arrays and Matrices", link: "https://www.geeksforgeeks.org/array-data-structure/" }, { name: "Stacks", link: "https://www.geeksforgeeks.org/stack-data-structure/" }, { name: "Queues", link: "https://www.geeksforgeeks.org/queue-data-structure/" }, { name: "Linked Lists (Singly, Doubly)", link: "https://www.geeksforgeeks.org/data-structures/linked-list/" }, { name: "Trees (Binary, Binary Search Tree - BST)", link: "https://www.geeksforgeeks.org/binary-search-tree-data-structure/" }, "Heaps (Min/Max Heap)", { name: "Hash Tables (Hashmaps)", link: "https://www.geeksforgeeks.org/hashing-data-structure/" }, "Graphs (Concepts and Representations)", "Tries (Prefix Tree)"] },
                    { module: "Module 4: Advanced Algorithms", topics: [{ name: "Complexity Analysis (Big O Notation)", link: "https://www.geeksforgeeks.org/analysis-algorithms-big-o-analysis/" }, "Divide and Conquer Strategy", { name: "Search Algorithms (Linear, Binary)", link: "https://www.khanacademy.org/computing/computer-science/algorithms/binary-search/a/binary-search" }, { name: "Sorting Algorithms (Bubble, Selection, Insertion, Merge, Quick Sort)", link: "https://www.geeksforgeeks.org/sorting-algorithms/" }, "Advanced Recursion", "Dynamic Programming (Concepts)", "Greedy Algorithms"] },
                    { module: "Module 5: Programming Paradigms", topics: [{ name: "Object-Oriented Programming (Classes, Inheritance, Polymorphism, Encapsulation)", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Details_of_the_Object_Model" }, { name: "Functional Programming (Pure Functions, Immutability, High-Order Functions)", link: "https://www.geeksforgeeks.org/functional-programming-paradigm/" }, "Procedural vs Declarative Programming", { name: "Design Patterns: Singleton, Factory, Observer", link: "https://refactoring.guru/design-patterns" }] },
                    { module: "Module 6: Databases", topics: ["Relational Database Concepts", { name: "SQL Language (SELECT, INSERT, UPDATE, DELETE, JOINs)", link: "https://www.w3schools.com/sql/" }, "Data Modeling (Entity-Relationship)", { name: "NoSQL Database Concepts (Document, Key-Value, Columnar)", link: "https://www.mongodb.com/nosql-explained" }, "ORM (Object-Relational Mapping) - Concepts and Practice", "Transactions (ACID)"] },
                    { module: "Module 7: Tools and Best Practices", topics: [{ name: "Version Control with Git and GitHub", link: "https://git-scm.com/book/en/v2" }, "Command Line (Terminal/Shell)", { name: "Package Managers (NPM/Yarn, Pip)", link: "https://docs.npmjs.com/about-npm" }, { name: "Software Testing (Unit, Integration, E2E)", link: "https://www.atlassian.com/continuous-delivery/software-testing/types-of-software-testing" }, { name: "Design Principles (SOLID, DRY, KISS)", link: "https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-5-principles-of-object-oriented-design" }, "Code Debugging", { name: "REST APIs (Concepts, HTTP Methods, Consumption)", link: "https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" }, "CI/CD - Continuous Integration & Delivery (Concepts)"] },
                    { module: "Module 8: Advanced Topics and Specialization", topics: ["Concurrency and Parallelism (Threads, Async/Await)", "Software Architecture (Monolith, Microservices, Serverless)", { name: "Information Security (OWASP Top 10)", link: "https://owasp.org/www-project-top-ten/" }, { name: "Cloud Computing (AWS/Azure/GCP - Concepts)", link: "https://aws.amazon.com/what-is-cloud-computing/" }, { name: "Containers (Docker - Concepts and Practice)", link: "https://www.docker.com/get-started/" }, "Message Queues (RabbitMQ/Kafka - Concepts)", "WebSockets and GraphQL", { name: "Explore Full Backend Roadmap", link: "https://roadmap.sh/backend" }] }
                ]
            }
        };

        class StudyApp {
            constructor() {
                this.studyProgress = [];
                this.apiKey = '';
                this.currentLang = 'pt';
                this.elements = {
                    // Mapeia todos os elementos da UI aqui para f√°cil acesso
                    mainTitle: document.getElementById('main-title'),
                    mainSubtitle: document.getElementById('main-subtitle'),
                    langSwitcher: document.getElementById('lang-switcher'),
                    progressTitle: document.getElementById('progress-title'),
                    progressBar: document.getElementById('progressBar'),
                    routinesTitle: document.getElementById('routines-title'),
                    dailyRoutineTitle: document.getElementById('daily-routine-title'),
                    dailyRoutineList: document.getElementById('daily-routine-list'),
                    weeklyRoutineTitle: document.getElementById('weekly-routine-title'),
                    weeklyRoutineList: document.getElementById('weekly-routine-list'),
                    monthlyRoutineTitle: document.getElementById('monthly-routine-title'),
                    monthlyRoutineList: document.getElementById('monthly-routine-list'),
                    modulesContainer: document.getElementById('modulesContainer'),
                    aiPanel: document.getElementById('ai-assistant'),
                    toggleAiBtn: document.getElementById('toggle-ai'),
                    closeAiBtn: document.getElementById('close-ai'),
                    aiAssistantTitle: document.getElementById('ai-assistant-title'),
                    chatMessages: document.getElementById('chat-messages'),
                    chatInput: document.getElementById('chat-input'),
                    sendBtn: document.getElementById('send-btn'),
                    settingsBtn: document.getElementById('settings-btn'),
                    apiKeyModal: document.getElementById('api-key-modal'),
                    modalTitle: document.getElementById('modal-title'),
                    modalDesc: document.getElementById('modal-desc'),
                    modalSteps: document.getElementById('modal-steps'),
                    apiKeyInput: document.getElementById('api-key-input'),
                    modalApiKeyPlaceholder: document.getElementById('api-key-input'),
                    saveApiKeyBtn: document.getElementById('save-api-key'),
                    cancelApiKeyBtn: document.getElementById('cancel-api-key'),
                };
                this.init();
            }

            init() {
                this.loadData();
                this.applyTranslations();
                this.renderModules();
                this.addEventListeners();
                this.initAIChat();
            }

            loadData() {
                this.currentLang = localStorage.getItem('currentLanguage') || 'pt';
                this.apiKey = localStorage.getItem('googleApiKey') || '';
                const savedProgress = JSON.parse(localStorage.getItem('studyProgress'));

                const structure = translations.pt.studyPlan; // Use a estrutura PT como base
                if (savedProgress && savedProgress.length === structure.length) {
                    this.studyProgress = savedProgress;
                } else {
                    this.studyProgress = structure.map(mod => ({
                        notes: "",
                        topics: mod.topics.map(() => ({ completed: false }))
                    }));
                }
            }

            saveData() {
                localStorage.setItem('studyProgress', JSON.stringify(this.studyProgress));
                localStorage.setItem('googleApiKey', this.apiKey);
                localStorage.setItem('currentLanguage', this.currentLang);
            }

            applyTranslations() {
                const t = translations[this.currentLang];
                document.documentElement.lang = this.currentLang;
                this.elements.mainTitle.textContent = t.mainTitle;
                this.elements.mainSubtitle.textContent = t.mainSubtitle;
                this.elements.progressTitle.textContent = t.progressTitle;
                this.elements.routinesTitle.textContent = t.routinesTitle;
                this.elements.dailyRoutineTitle.textContent = t.dailyRoutineTitle;
                this.elements.weeklyRoutineTitle.textContent = t.weeklyRoutineTitle;
                this.elements.monthlyRoutineTitle.textContent = t.monthlyRoutineTitle;
                this.elements.dailyRoutineList.innerHTML = t.dailyRoutineList.map(item => `<li>${item}</li>`).join('');
                this.elements.weeklyRoutineList.innerHTML = t.weeklyRoutineList.map(item => `<li>${item}</li>`).join('');
                this.elements.monthlyRoutineList.innerHTML = t.monthlyRoutineList.map(item => `<li>${item}</li>`).join('');
                this.elements.aiAssistantTitle.textContent = t.aiAssistantTitle;
                this.elements.chatInput.placeholder = t.chatPlaceholder;
                this.elements.sendBtn.textContent = t.sendButton;
                this.elements.modalTitle.textContent = t.modalTitle;
                this.elements.modalDesc.textContent = t.modalDesc;
                this.elements.modalSteps.innerHTML = t.modalSteps.map(item => `<li>${item}</li>`).join('');
                this.elements.modalApiKeyPlaceholder.placeholder = t.modalApiKeyPlaceholder;
                this.elements.saveApiKeyBtn.textContent = t.modalSave;
                this.elements.cancelApiKeyBtn.textContent = t.modalCancel;
            }

            updateProgress() {
                const allTopics = this.studyProgress.flatMap(module => module.topics);
                const completedTopics = allTopics.filter(topic => topic.completed).length;
                const totalTopics = allTopics.length;
                const percentage = totalTopics > 0 ? Math.round((completedTopics / totalTopics) * 100) : 0;
                
                this.elements.progressBar.style.width = `${percentage}%`;
                this.elements.progressBar.textContent = `${percentage}%`;
            }

            renderModules() {
                const t = translations[this.currentLang];
                this.elements.modulesContainer.innerHTML = '';
                t.studyPlan.forEach((moduleData, moduleIndex) => {
                    const moduleEl = document.createElement('div');
                    moduleEl.className = 'bg-white p-6 rounded-xl shadow-sm border border-slate-200';

                    const topicsHtml = moduleData.topics.map((topic, topicIndex) => {
                        const topicName = typeof topic === 'string' ? topic : topic.name;
                        const topicLink = topic.link || null;
                        const progress = this.studyProgress[moduleIndex].topics[topicIndex];

                        let topicNameHtml = `<span class="ml-3 text-slate-700 flex-grow">${topicName}</span>`;
                        if (topicLink) {
                            topicNameHtml += `<a href="${topicLink}" target="_blank" rel="noopener noreferrer" class="ml-4 text-sm text-indigo-600 hover:text-indigo-800 font-medium shrink-0">${t.resourceButton}</a>`;
                        }
                        return `
                            <div class="flex items-center py-2 border-b border-slate-100 last:border-b-0">
                                <label for="topic-${moduleIndex}-${topicIndex}" class="flex items-center cursor-pointer w-full">
                                    <input id="topic-${moduleIndex}-${topicIndex}" type="checkbox" class="h-5 w-5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 custom-checkbox" ${progress.completed ? 'checked' : ''} data-module="${moduleIndex}" data-topic="${topicIndex}">
                                    ${topicNameHtml}
                                </label>
                            </div>`;
                    }).join('');

                    moduleEl.innerHTML = `
                        <h3 class="text-2xl font-semibold mb-4 text-slate-800">${moduleData.module}</h3>
                        <div class="space-y-2">${topicsHtml}</div>
                        <div class="mt-4 pt-4 border-t border-slate-200">
                            <button class="text-sm text-indigo-600 hover:text-indigo-800 font-medium" data-notes-toggle="${moduleIndex}">${t.notesButton}</button>
                            <div id="notes-container-${moduleIndex}" class="notes-container">
                                <textarea class="w-full h-24 p-2 border border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="${t.notesPlaceholder}" data-notes-input="${moduleIndex}">${this.studyProgress[moduleIndex].notes || ''}</textarea>
                            </div>
                        </div>`;
                    this.elements.modulesContainer.appendChild(moduleEl);
                });
                this.updateProgress();
            }

            addEventListeners() {
                this.elements.modulesContainer.addEventListener('change', (e) => {
                    if (e.target.matches('input[type="checkbox"]')) {
                        const { module, topic } = e.target.dataset;
                        this.studyProgress[module].topics[topic].completed = e.target.checked;
                        this.saveData();
                        this.updateProgress();
                    }
                });

                this.elements.modulesContainer.addEventListener('input', (e) => {
                    if (e.target.matches('textarea[data-notes-input]')) {
                        const { notesInput } = e.target.dataset;
                        this.studyProgress[notesInput].notes = e.target.value;
                        this.saveData();
                    }
                });

                this.elements.modulesContainer.addEventListener('click', (e) => {
                    if (e.target.matches('button[data-notes-toggle]')) {
                        const { notesToggle } = e.target.dataset;
                        document.getElementById(`notes-container-${notesToggle}`).classList.toggle('open');
                    }
                });
                
                this.elements.langSwitcher.addEventListener('click', () => {
                    this.currentLang = this.currentLang === 'pt' ? 'en' : 'pt';
                    this.saveData();
                    this.applyTranslations();
                    this.renderModules();
                });

                this.elements.toggleAiBtn.addEventListener('click', () => this.elements.aiPanel.classList.remove('translate-x-full'));
                this.elements.closeAiBtn.addEventListener('click', () => this.elements.aiPanel.classList.add('translate-x-full'));
                this.elements.settingsBtn.addEventListener('click', () => {
                    this.elements.apiKeyInput.value = this.apiKey;
                    this.elements.apiKeyModal.style.display = 'flex';
                });
                this.elements.cancelApiKeyBtn.addEventListener('click', () => this.elements.apiKeyModal.style.display = 'none');
                this.elements.saveApiKeyBtn.addEventListener('click', () => {
                    const newApiKey = this.elements.apiKeyInput.value.trim();
                    if (newApiKey) {
                        this.apiKey = newApiKey;
                        this.saveData();
                        this.elements.apiKeyModal.style.display = 'none';
                        this.addMessage('system', translations[this.currentLang].systemMsgApiKeySaved);
                    }
                });
                this.elements.sendBtn.addEventListener('click', () => this.handleSendMessage());
                this.elements.chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') this.handleSendMessage();
                });
            }

            addMessage(sender, text, isHtml = false) {
                const messageEl = document.createElement('div');
                let messageClasses = 'p-3 rounded-lg max-w-xs break-words';
                if (sender === 'user') {
                    messageClasses += ' bg-indigo-500 text-white self-end';
                } else if (sender === 'ai') {
                    messageClasses += ' bg-slate-200 text-slate-800 self-start message-content';
                } else { // System message
                    messageClasses += ' bg-yellow-100 text-yellow-800 self-center text-sm w-full text-center';
                }
                messageEl.className = messageClasses;
                
                if (isHtml) {
                    messageEl.innerHTML = text;
                } else {
                    messageEl.textContent = text;
                }

                this.elements.chatMessages.appendChild(messageEl);
                this.elements.chatMessages.scrollTop = this.elements.chatMessages.scrollHeight;
                return messageEl;
            }

            async handleSendMessage() {
                const userPrompt = this.elements.chatInput.value.trim();
                const t = translations[this.currentLang];
                if (!userPrompt) return;

                if (!this.apiKey) {
                    this.addMessage('system', t.systemMsgApiKeyNeeded);
                    this.elements.apiKeyModal.style.display = 'flex';
                    return;
                }

                this.addMessage('user', userPrompt);
                this.elements.chatInput.value = '';
                
                const thinkingMessage = this.addMessage('ai', '<div class="spinner"></div>', true);

                try {
                    const payload = {
                        contents: [{
                            role: "user",
                            parts: [{ text: `You are a friendly and helpful programming tutor. Answer the following question clearly using Markdown and with code examples, if applicable: ${userPrompt}` }]
                        }]
                    };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${this.apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`API error: ${response.status} ${response.statusText}`);

                    const result = await response.json();
                    
                    if (result.candidates?.[0]?.content.parts?.[0]?.text) {
                        const aiText = result.candidates[0].content.parts[0].text;
                        thinkingMessage.innerHTML = marked.parse(aiText);
                    } else {
                        thinkingMessage.textContent = t.systemMsgNoResponse;
                    }
                } catch (error) {
                    console.error("Error calling AI API:", error);
                    thinkingMessage.textContent = t.systemMsgError;
                }
            }
            
            initAIChat() {
                const t = translations[this.currentLang];
                if (!this.apiKey) {
                    this.addMessage('system', t.systemMsgWelcome);
                } else {
                    this.addMessage('system', t.systemMsgReady);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => new StudyApp());
    </script>
</body>
</html>
